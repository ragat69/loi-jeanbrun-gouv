# ==================================================
# Loi Jeanbrun - Configuration Apache
# ==================================================

# Activer le moteur de rewriting
RewriteEngine On

# Base du rewriting
RewriteBase /

# ==================================================
# Forcer HTTPS
# ==================================================
RewriteCond %{HTTPS} off
RewriteRule ^(.*)$ https://%{HTTP_HOST}/$1 [R=301,L]

# ==================================================
# Forcer la version sans www (et HTTPS)
# ==================================================
RewriteCond %{HTTP_HOST} ^www\.(.+)$ [NC]
RewriteRule ^(.*)$ https://%1/$1 [R=301,L]

# ==================================================
# Supprimer l'extension .php des URLs
# ==================================================

# Si l'utilisateur accede a un fichier .php, rediriger vers l'URL sans extension
RewriteCond %{THE_REQUEST} \s/([^.]+)\.php[\s?] [NC]
RewriteRule ^ /%1 [R=301,L]

# Si l'URL sans extension correspond a un fichier .php existant, le servir
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_FILENAME}\.php -f
RewriteRule ^(.+)$ $1.php [L]

# ==================================================
# Pages d'erreur personnalisees (optionnel)
# ==================================================
ErrorDocument 404 /index.php
ErrorDocument 500 /index.php

# ==================================================
# Securite supplementaire
# ==================================================

# Bloquer l'acces aux fichiers sensibles
<FilesMatch "^\.">
    Order allow,deny
    Deny from all
</FilesMatch>

# Bloquer l'acces au dossier includes
<IfModule mod_rewrite.c>
    RewriteRule ^includes/ - [F,L]
</IfModule>

# Desactiver l'affichage du contenu des repertoires
Options -Indexes

# Protection contre le clickjacking
<IfModule mod_headers.c>
    Header always set X-Frame-Options "SAMEORIGIN"
    Header always set X-Content-Type-Options "nosniff"
    Header always set X-XSS-Protection "1; mode=block"
</IfModule>
